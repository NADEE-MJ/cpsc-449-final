<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>All Classes</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <div class="container mt-5">
      <h1>All Classes</h1>
      <ul id="classList" class="list-group">
        <!-- Classes will be dynamically loaded here -->
      </ul>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        fetchClasses();
      });

      function fetchClasses() {
        fetch("/api/classes")
          .then((response) => response.json())
          .then((data) => {
            const classList = document.getElementById("classList");
            classList.innerHTML = ""; // Clear previous entries
            data.classes.forEach((cls) => {
              const li = document.createElement("li");
              li.className = "list-group-item d-flex justify-content-between align-items-center";
              li.innerHTML = `
                            ${cls.subject} ${cls.class_number} - ${cls.professor}
                            <span>
                                <button class="btn btn-primary btn-sm mx-1" onclick="editClass('${cls.id}')">Edit</button>
                                <button class="btn btn-danger btn-sm mx-1" onclick="deleteClass('${cls.id}')">Delete</button>
                                <button class="btn btn-success btn-sm mx-1" onclick="enrollInClass('${cls.id}')">Enroll</button>
                            </span>
                        `;
              classList.appendChild(li);
            });
          })
          .catch((error) => console.error("Error fetching classes:", error));
      }

      function editClass(classId) {
        window.location.href = `/edit_class/${classId}`; // Redirect to class edit page
      }

      function deleteClass(classId) {
        if (confirm("Are you sure you want to delete this class?")) {
          fetch(`/api/delete_class/${classId}`, { method: "DELETE" })
            .then((response) => response.json())
            .then((data) => {
              alert(data.message);
              fetchClasses(); // Refresh the list after deletion
            })
            .catch((error) => console.error("Error deleting class:", error));
        }
      }

      function enrollInClass(classId) {
        fetch(`/api/enroll_class/${classId}`, { method: "POST" })
          .then((response) => response.json())
          .then((data) => {
            alert(data.message);
          })
          .catch((error) => console.error("Error enrolling in class:", error));
      }
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
